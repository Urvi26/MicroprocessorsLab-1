#include <xc.inc>
psect	code, abs	
main: 	org 0x0
 	goto	setup
	org 0x100

setup: 	movlw	0x30	; delay value
	movwf   0x21	; moving delay value into delay file registers
	movlw	0xff
	movwf	0x22
	movwf	0x23
	
	movlw	0x00
	movwf	TRISH	; setting PORTH as an output
	
	movlw	0x00
	movwf	TRISD	;setting PORTD as an output
	
	movlw	0x00
	movwf	TRISC
	
	;setf	TRISE
	banksel	PADCFG1	; selecting bank register
	bsf REPU	; setting PORTE pull-ups on
	movlb	0x00	;setting bank register back to 0
	call delay
	
	clrf	LATE	;clear LATE
	call delay
	
start:	movlw	0x0f
	movwf	TRISE	;setting bits E0-E3 as inputs and E4-E7 as outputs
	call delay
	
	movf PORTE, W, A
	movwf	PORTD	;move keyboard column input into PORTD 
	call delay
	
	movlw	0xf0
	movwf	TRISE	;setting bits E4-7 as inputs and E0-3 as outputs
	call delay
	
	movf	PORTE, W, A
	movwf	PORTH	; move keyboard row input into PORTH
	call delayb  
	
	movf	PORTH, W, A
	movwf	0x24, A
	movf	PORTD, W, A
	addwf	0x24, 1, 0
	movff	0x24, PORTJ
	
check1:	movlw	0x01
	movwf	PORTC, A
	movlw	11101110B   ;check value into W
    	CPFSLT	0x24
	bra end1
	
	movlw	0x02
	movwf	PORTC, A
	movlw	11101101B
	CPFSLT	0x24
	bra	end1
	
	movlw	0x03
	movwf	PORTC, A
	movlw	11101011B   ;check value into W
    	CPFSLT	0x24
	bra end1
 
	movlw	0x0F
	movwf	PORTC, A
	movlw	11100111B
	CPFSLT	0x24
	bra	end1
	
	movlw	0x04
	movwf	PORTC, A
	movlw	11011110B   ;check value into W
    	CPFSLT	0x24
	bra end1
 
	movlw	0x05
	movwf	PORTC, A
	movlw	11011101B
	CPFSLT	0x24
	bra	end1
	
	movlw	0x06
	movwf	PORTC, A
	movlw	110110110B   ;check value into W
    	CPFSLT	0x24
	bra end1
 
	movlw	0x0E
	movwf	PORTC, A
	movlw	11010111B
	CPFSLT	0x24
	bra	end1
	
	movlw	0x07
	movwf	PORTC, A
	movlw	10111110B   ;check value into W
    	CPFSLT	0x24
	bra end1
 
	movlw	0x08
	movwf	PORTC, A
	movlw	10111101B
	CPFSLT	0x24
	bra	end1
	
	movlw	0x09
	movwf	PORTC, A
	movlw	10111011B   ;check value into W
    	CPFSLT	0x24
	bra end1
 
	
	
end1: goto	$	;keep re-running code so that keys pressed can be seen almost immediately on PORTs

delay:	;call delayb
	decfsz	0x21
	bra delay
	return
	
delayb:	call delayc
	decfsz	0x22
	bra delayb
	return	
	
delayc: decfsz	0x23
	bra delayc
	return
	
	end main
